## 素材美化

- 修改背景图片。

  ![image-20210128205729493](C:\Users\Haiyun\AppData\Roaming\Typora\typora-user-images\image-20210128205729493.png)

- 修改敌机图片、玩家飞机图片。

  ![image-20210128205747581](C:\Users\Haiyun\AppData\Roaming\Typora\typora-user-images\image-20210128205747581.png)

- 修改子弹图片。

  ![image-20210128205819966](C:\Users\Haiyun\AppData\Roaming\Typora\typora-user-images\image-20210128205819966.png)![image-20210128205831685](C:\Users\Haiyun\AppData\Roaming\Typora\typora-user-images\image-20210128205831685.png)

- 修改生命、弹药、油量、火力、清除、缩小道具图片。

  ![image-20210128205925350](C:\Users\Haiyun\AppData\Roaming\Typora\typora-user-images\image-20210128205925350.png)

- 修改爆炸特效、胜利、失败图片。

  ![image-20210128205938576](C:\Users\Haiyun\AppData\Roaming\Typora\typora-user-images\image-20210128205938576.png)![image-20210128210011960](C:\Users\Haiyun\AppData\Roaming\Typora\typora-user-images\image-20210128210011960.png)

  

## 逻辑优化

- 增加窗口关闭游戏设置，不再需要通过停止程序来关闭。

  ```java
  public static void main(String args[]) {
      Battlefield f = new Battlefield();
      f.showcomponent();
      f.setSize(1000, 900);
      f.setVisible(true);
      f.gameperpare();
      f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);//关闭游戏
  }
  ```
  
- 增加主题选择，不同主题对应不同背景、敌机、玩家飞机样式。

  ```java
  switch (level) {
      case 1:
          myplane = getToolkit().getImage("Airplanes/con01.png");
          eplane1 = getToolkit().getImage("Airplanes/ep01.png");
          eplane2 = getToolkit().getImage("Airplanes/ep02.png");
          Airplane.eplane1 = eplane1;
          Airplane.eplane2 = eplane2;
          backgroud = getToolkit().getImage("Backgrounds/bg1.jpg");
          break;
      case 2:
          myplane = getToolkit().getImage("Airplanes/con02.png");
          eplane1 = getToolkit().getImage("Airplanes/ep03.png");
          eplane2 = getToolkit().getImage("Airplanes/ep04.png");
          Airplane.eplane1 = eplane1;
          Airplane.eplane2 = eplane2;
          backgroud = getToolkit().getImage("Backgrounds/bg2.jpg");
          break;
      case 3:
          myplane = getToolkit().getImage("Airplanes/con03.png");
          eplane1 = getToolkit().getImage("Airplanes/ep05.png");
          eplane2 = getToolkit().getImage("Airplanes/ep06.png");
          Airplane.eplane1 = eplane1;
          Airplane.eplane2 = eplane2;
          backgroud = getToolkit().getImage("Backgrounds/bg3.jpg");
          break;
      case 4:
          myplane = getToolkit().getImage("Airplanes/con04.png");
          eplane1 = getToolkit().getImage("Airplanes/ep07.png");
          eplane2 = getToolkit().getImage("Airplanes/ep08.png");
          Airplane.eplane1 = eplane1;
          Airplane.eplane2 = eplane2;
          backgroud = getToolkit().getImage("Backgrounds/bg4.jpg");
          break;
      case 5:
          myplane = getToolkit().getImage("Airplanes/con05.png");
          eplane1 = getToolkit().getImage("Airplanes/ep09.png");
          eplane2 = getToolkit().getImage("Airplanes/ep10.png");
          Airplane.eplane1 = eplane1;
          Airplane.eplane2 = eplane2;
          backgroud = getToolkit().getImage("Backgrounds/bg5.jpg");
          break;
      default:
          myplane = getToolkit().getImage("Airplanes/con01.png");
          eplane1 = getToolkit().getImage("Airplanes/ep01.png");
          eplane2 = getToolkit().getImage("Airplanes/ep02.png");
          Airplane.eplane1 = eplane1;
          Airplane.eplane2 = eplane2;
          backgroud = getToolkit().getImage("Backgrounds/bg1.jpg");
          break;
  }
  ```

- 修复边界出界bug，并实现多按键同时响应。

  ```java
  public synchronized void keyPressed(KeyEvent e) {
      pressed.add(e.getKeyCode());
  
      // 控制按键
      if (pressed.contains(KeyEvent.VK_RIGHT)) {
          if (Controlplane.pX <= 1000 - Controlplane.pWidth)
              Controlplane.pX += Controlplane.speed;
      }
      if (pressed.contains(KeyEvent.VK_LEFT)) {
          if (Controlplane.pX >= 0)
              Controlplane.pX -= Controlplane.speed;
      }
      if (pressed.contains(KeyEvent.VK_UP)) {
          if (Controlplane.pY > 0)
              Controlplane.pY -= Controlplane.speed;
      }
      if (pressed.contains(KeyEvent.VK_DOWN)) {
          if (Controlplane.pY <= 900 - Controlplane.pHeight)
              Controlplane.pY += Controlplane.speed;
      }
      if (pressed.contains(KeyEvent.VK_SPACE)) {
          if (Controlplane.bulletnum - Controlplane.fireLevel >= 0) {
              Controlplane.bulletnum -= Controlplane.fireLevel;
              fire = true;
              m2.gunshotclip.play();
          }
      }
      if (pressed.contains(KeyEvent.VK_1)) {
          if (Controlplane.speed < 50) {
              Controlplane.speed += 10;
              t4.setText(Controlplane.speed + "");
          }
      }
      if (pressed.contains(KeyEvent.VK_2)) {
          if (Controlplane.speed > 10) {
              Controlplane.speed -= 10;
              t4.setText(Controlplane.speed + "");
          }
      }
  }
  ```

- 修复敌机、玩家飞机、子弹、道具、石头碰撞视觉不匹配bug。

  ​		修改了Airplane、Accessory、Bullet类，将长度宽度在数据域中初始化，不再从构造方法传入长度宽度的变量。同时优化碰撞判定条件，使得碰撞与视觉效果更匹配。

  ```java
  public class Airplane implements Serializable {
  	int pX, pY;
  	int pWidth = 80, pHeight = 60;
      ...
      public Airplane(int x, int y) {
  		super();
  		pX = x;
  		pY = y;
  	}
      ...
  }
  ```
  ```java
  public class Accessory implements Serializable {
  	int aX, aY;
  	int aWidth = 50, aHeight = 50;
      ...
  }
  ```
  ```java
  public class Bullet implements Serializable {
  	int bX, bY;
  	int bWidth = 50, bHeight = 50;
  	...
  	public Bullet(int x, int y) {
  		super();
  		bX = x;
  		bY = y;
  	}
  	...
  }
  ```

  

- 增加Rock类，石头无法被击毁，且飞机碰撞直接爆炸。

  ```java
  public class Rock implements Serializable {
  	int x, y;
  	int width = 63, height = 63;
  	int speed = 1;
  	transient Image image;
  
  	public Rock(int x, int y) {
  		super();
  		this.x = x;
  		this.y = y;
  	}
  }
  ```

- 增加道具：机型缩小、火力增强、消除石头。

  ```java
  //变小
  if (a.typeint == 4) {
      pWidth *= 0.9;
      pHeight *= 0.9;
  }
  //火力
  if (a.typeint == 5) {
      fireLevel += 2;
  }
  //rock消失
  if (a.typeint == 6) {
      for (Rock rock : Battlefield.rockList) {
          if (rock.y > 0) {// 控制rock消失
              Battlefield.rockList.remove(rock);
          }
      }
  }
  ```

- 分离敌机子弹和玩家子弹，使得子弹逻辑独立。

  ```java
  // 子弹
  if (fire) {
      //加子弹
      bulletsList1.add(new Bullet(Controlplane.pX + Controlplane.pWidth / 2 - 25, Controlplane.pY));
      //加额外子弹
      for (int i = 0; i < (Controlplane.fireLevel - 1) / 2; i++) {
          bulletsList1.add(	new Bullet(Controlplane.pX - Controlplane.pWidth / 2 * (i - 1) - 25, Controlplane.pY));
          bulletsList1.add(new Bullet(Controlplane.pX + Controlplane.pWidth / 2 * i - 25, Controlplane.pY));
      }
      fire = false;
      t1.setText(Controlplane.bulletnum + "");
  }
  //controlplane绘制子弹
  Iterator bnums1 = bulletsList1.iterator();
  while (bnums1.hasNext()) {
      Bullet b = (Bullet) bnums1.next();
      drawOffScreen.drawImage(bullet1, b.bX, b.bY, null);
      b.bY -= b.speed;
      if ((b.bY < 0) || (b.bY > 900)) {
          b = null;
          bnums1.remove();
          continue;
      }
  }
  //enemyplane绘制子弹，击中controlplane
  Iterator bnums0 = bulletsList0.iterator();
  while (bnums0.hasNext()) {
      Bullet b = (Bullet) bnums0.next();
      drawOffScreen.drawImage(bullet0, b.bX, b.bY, null);
      b.bY -= b.speed;
      if ((b.bY < 0) || (b.bY > 900)) {
          b = null;
          bnums0.remove();
          continue;
      }
      if ((Controlplane.hit(b))) {
          b = null;
          bnums0.remove();
          m2.hitclip.play();
          t1.setText(Controlplane.bulletnum + "");
          t2.setText(Controlplane.life + "");
          t3.setText(Controlplane.oil + "");
          t4.setText(Controlplane.speed + "");
          t5.setText(Controlplane.pHeight + "*" + Controlplane.pWidth);
      }
  }
  ```